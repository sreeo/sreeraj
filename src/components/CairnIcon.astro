---
interface Props {
  title: string;
  variant?: 'tech' | 'trek';
  width?: number;
  height?: number;
}

const { title, variant = 'tech', width = 60, height = 80 } = Astro.props;
const isTrek = variant === 'trek';

// Deterministic hash from title
function hashStr(s: string): number {
  let h = 0;
  for (let i = 0; i < s.length; i++) h = ((h << 5) - h + s.charCodeAt(i)) | 0;
  return Math.abs(h);
}

function seededRng(seed: number) {
  let s = seed;
  return function() {
    s = (s * 16807 + 0) % 2147483647;
    return (s - 1) / 2147483646;
  };
}

const seed = hashStr(title);
const rng = seededRng(seed);
const stoneCount = 4 + Math.floor(rng() * 4);

interface Stone {
  x: number;
  y: number;
  w: number;
  h: number;
  opacity: number;
  skew?: number;
  rx?: number;
  ry?: number;
}

const stones: Stone[] = [];
let y = height - 10;
for (let i = 0; i < stoneCount; i++) {
  const w = 8 + rng() * 16 - i * 1.2;
  const h = 4 + rng() * 6;
  const x = width / 2 - w / 2 + (rng() - 0.5) * 5;
  const opacity = 0.4 + rng() * 0.4;

  if (isTrek) {
    stones.push({ x: x + w/2, y: y - h/2, w, h, opacity, rx: w/2, ry: h/2 });
  } else {
    const skew = (rng() - 0.5) * 4;
    stones.push({ x, y: y - h, w, h, opacity, skew });
  }
  y -= h + 1 + rng() * 2;
}

const color = isTrek ? '217, 119, 6' : '34, 211, 238';
const strokeColor = isTrek ? 'rgba(217,119,6' : 'rgba(34,211,238';
---

<svg width={width} height={height} viewBox={`0 0 ${width} ${height}`} xmlns="http://www.w3.org/2000/svg" class="cairn-icon">
  <line x1={width * 0.2} y1={height - 5} x2={width * 0.8} y2={height - 5} stroke={`rgba(${color}, 0.3)`} stroke-width="1"/>
  {stones.map(s => (
    isTrek ? (
      <ellipse
        cx={s.x}
        cy={s.y}
        rx={s.rx}
        ry={s.ry}
        fill={`rgba(${color}, ${s.opacity})`}
        stroke={`${strokeColor}, ${s.opacity + 0.2})`}
        stroke-width="0.5"
      />
    ) : (
      <rect
        x={s.x}
        y={s.y}
        width={s.w}
        height={s.h}
        fill={`rgba(${color}, ${s.opacity * 0.7})`}
        stroke={`${strokeColor}, ${s.opacity})`}
        stroke-width="0.5"
        transform={`skewX(${s.skew})`}
      />
    )
  ))}
</svg>
