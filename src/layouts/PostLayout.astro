---
import BaseLayout from './BaseLayout.astro';
import FormattedDate from '../components/FormattedDate.astro';
import TagList from '../components/TagList.astro';
import WeatherAtmosphere from '../components/WeatherAtmosphere.astro';
import TrekStatsBar from '../components/TrekStatsBar.astro';
import ElevationProgress from '../components/ElevationProgress.astro';

interface TrekStats {
  elevation?: string;
  distance?: string;
  duration?: string;
  difficulty?: string;
  basecamp?: string;
  season?: string;
  startAlt?: number;
  peakAlt?: number;
}

interface Props {
  title: string;
  description?: string;
  pubDate: Date;
  updatedDate?: Date;
  featureImage?: string;
  tags?: string[];
  author?: string;
  readingTime?: number;
  theme?: 'tech' | 'trek';
  prevPost?: { slug: string; title: string } | null;
  nextPost?: { slug: string; title: string } | null;
  trekStats?: TrekStats;
}

const {
  title,
  description,
  pubDate,
  updatedDate,
  featureImage,
  tags = [],
  author,
  readingTime,
  theme = 'tech',
  prevPost,
  nextPost,
  trekStats,
} = Astro.props;

const isTrek = theme === 'trek';
---

<BaseLayout title={`${title} â€” sreeraj.dev`} description={description} image={featureImage} theme={theme}>
  {isTrek && <WeatherAtmosphere />}
  {isTrek && trekStats && (
    <ElevationProgress
      startAlt={trekStats.startAlt || 1800}
      peakAlt={trekStats.peakAlt || 4000}
    />
  )}

  <article class:list={["max-w-[720px] mx-auto relative z-10", isTrek && "trek-journal"]}>
    {featureImage && (
      <div class:list={[isTrek ? "trek-hero-wrap" : ""]}>
        <img
          src={featureImage}
          alt={title}
          class:list={["post-hero-image w-full", isTrek ? "trek-hero" : "mb-6"]}
        />
        {isTrek && (
          <div class="trek-hero-overlay">
            <span class="trek-hero-tag">Field Journal</span>
          </div>
        )}
      </div>
    )}

    <header class="mb-8">
      <h1 class="post-header-title text-3xl sm:text-4xl mb-3">{title}</h1>
      <div class="post-header-meta flex flex-wrap items-center gap-3">
        {author && <span>{author}</span>}
        <span>&middot;</span>
        <FormattedDate date={pubDate} />
        {readingTime && (
          <>
            <span>&middot;</span>
            <span>{readingTime} min read</span>
          </>
        )}
      </div>
      {updatedDate && updatedDate.getTime() !== pubDate.getTime() && (
        <p class="post-header-meta mt-1 opacity-60">
          Updated <FormattedDate date={updatedDate} />
        </p>
      )}
      {tags.length > 0 && (
        <div class="mt-3">
          <TagList tags={tags} />
        </div>
      )}
      {isTrek && trekStats && (
        <TrekStatsBar
          elevation={trekStats.elevation}
          distance={trekStats.distance}
          duration={trekStats.duration}
          difficulty={trekStats.difficulty}
          basecamp={trekStats.basecamp}
          season={trekStats.season}
        />
      )}
    </header>

    <div class:list={["prose", isTrek && "trek-prose"]}>
      <slot />
    </div>

    {(prevPost || nextPost) && (
      <nav class="mt-12 pt-8 post-nav-border border-t flex justify-between gap-4">
        {prevPost ? (
          <a href={`/${prevPost.slug}/`} class="post-nav-link">
            &larr; {prevPost.title}
          </a>
        ) : <span />}
        {nextPost ? (
          <a href={`/${nextPost.slug}/`} class="post-nav-link text-right">
            {nextPost.title} &rarr;
          </a>
        ) : <span />}
      </nav>
    )}
  </article>
</BaseLayout>
